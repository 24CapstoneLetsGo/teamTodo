<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Team ToDo App</title>
<link rel="stylesheet" href="./css/styles.css">
</head>
<body>
<div class="sidebar">
  <div class="logo">
    <span class="team">Team</span><br>
    <span class="todo">ToDo</span>
  </div>
  <nav>
    <ul>
      <li><button onclick="location.href='index.html'"><img src="./images/yellowhome.png" alt="Home"></button></li>
      <li><button onclick="location.href='edit_profile.html'"><img src="./images/blackprofile.png" alt="Profile"></button></li>
      <li><button onclick="location.href='login.html'"><img src="./images/blacklogout.png" alt="Logout"></button></li>
    </ul>
  </nav>
  <div class="help">
    <button onclick="location.href='help.html'"><img src="./images/help.png" alt="Help"></button>
  </div>
</div>
<div class="main-container">
  <div class="top-container">
    <div class="top-left">
      <div class="calendar-header">
        <button class="calendar-nav-button prev-month">&lt;</button>
        <h2 id="calendar-month">May 2024</h2>
        <button class="calendar-nav-button next-month">&gt;</button>
      </div>
      <table id="calendar">
        <thead>
          <tr>
            <th>일</th>
            <th>월</th>
            <th>화</th>
            <th>수</th>
            <th>목</th>
            <th>금</th>
            <th>토</th>
          </tr>
        </thead>
        <tbody>
          <!-- 달력 날짜가 동적으로 생성될 부분 -->
        </tbody>
      </table>
    </div>
    <div class="top-right">
      <div class="progress">
        <h2>Progress</h2>
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
        <p class="progress-percent">33%</p>
      </div>
      <div class="team-members">
        <div class="team-list">
          <h3>Team Members</h3>
          <ul>
            <li class="team-member-item" data-team="designer">Designer</li>
            <li class="team-member-item" data-team="front-end">Front-end</li>
            <li class="team-member-item" data-team="back-end">Back-end</li>
            <li class="team-member-item" data-team="ai">AI</li>
            <li class="team-member-item" data-team="planner">기획</li>
          </ul>
        </div>
        <div class="member-details" id="member-details"></div>
      </div>
    </div>
  </div>
  <div class="bottom-container">
    <div class="bottom-left">
      <h2>Team To-Do CheckList</h2>
      <div class="todo-controls">
        <select class="todo-dropdown">
          <option value="task">할 일</option>
          <option value="title">제목</option>
        </select>
        <input type="text" id="todo-input" placeholder="내용을 입력하세요">
        <button class="add-todo-button">+</button>
      </div>
      <ul id="todo-list">
        <li>
          <span class="content bold">홈페이지 UI 수정</span>
          <button class="drag-handle">☰</button>
        </li>
        <li>
          <span class="content"><input type="checkbox"> home 화면 비율 일치 (~5/13)</span>
          <button class="drag-handle">☰</button>
        </li>
        <li>
          <span class="content"><input type="checkbox"> 프로필 설정 페이지 색상 변경 (~5/28)</span>
          <button class="drag-handle">☰</button>
        </li>
        <li>
          <span class="content"><input type="checkbox"> Item Card</span>
          <button class="drag-handle">☰</button>
        </li>
      </ul>
    </div>
    <div class="bottom-right">
      <h2 class="bold">Notice</h2>
      <div id="notice-list">
        <p>신유진 님이 ToDo를 생성하였습니다.</p>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const teamMembers = document.querySelectorAll(".team-member-item");
    const memberDetails = document.getElementById("member-details");

    // 사용자 정보 가져오기
    function fetchUsersByTeam(team) {
        fetch(`get_team_users.php?team=${team}`)
            .then(response => response.json())
            .then(users => {
                displayUsers(users);
            })
            .catch(error => console.error('Error fetching users:', error));
    }

    // 사용자 정보 표시
    function displayUsers(users) {
        memberDetails.innerHTML = ""; // 기존 내용을 지우고 새로 추가
        users.forEach(user => {
            const userProfile = document.createElement("div");
            userProfile.classList.add("profile-set");
            userProfile.style.display = "flex";
            userProfile.style.marginBottom = "10px"; // 각 프로필 사이에 여백 추가

            const profilePic = document.createElement("img");
            profilePic.src = "./images/gu.png"; // 프로필 사진 경로를 실제 사진 경로로 변경
            profilePic.alt = "Member Profile";
            profilePic.classList.add("profile-pic");

            const profileInfo = document.createElement("div");
            profileInfo.classList.add("profile-info");

            const profileName = document.createElement("p");
            profileName.classList.add("name");
            profileName.textContent = user.username;

            const profileTeam = document.createElement("p");
            profileTeam.classList.add("position");
            profileTeam.textContent = `${user.group_name} / ${user.team_name}`;

            profileInfo.appendChild(profileName);
            profileInfo.appendChild(profileTeam);
            userProfile.appendChild(profilePic);
            userProfile.appendChild(profileInfo);

            memberDetails.appendChild(userProfile);
        });
    }

    teamMembers.forEach(function (member) {
        member.addEventListener("click", function () {
            const team = this.getAttribute("data-team");
            fetchUsersByTeam(team);
        });
    });

    // 오늘 날짜 배경색 변경
    const today = new Date();
    let currentMonth = today.getMonth();
    let currentYear = today.getFullYear();

    function generateCalendar(month, year) {
      const calendar = document.querySelector("#calendar tbody");
      calendar.innerHTML = "";
      const monthAndYear = document.getElementById("calendar-month");
      const firstDay = new Date(year, month).getDay();
      const daysInMonth = 32 - new Date(year, month, 32).getDate();
      const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
      monthAndYear.textContent = `${months[month]} ${year}`;

      let date = 1;
      for (let i = 0; i < 6; i++) {
        const row = document.createElement("tr");
        for (let j = 0; j < 7; j++) {
          if (i === 0 && j < firstDay) {
            const cell = document.createElement("td");
            row.appendChild(cell);
          } else if (date > daysInMonth) {
            break;
          } else {
            const cell = document.createElement("td");
            cell.textContent = date;
            if (date === today.getDate() && year === today.getFullYear() && month === today.getMonth()) {
              cell.style.backgroundColor = "#C6E4FF";
            }
            row.appendChild(cell);
            date++;
          }
        }
        calendar.appendChild(row);
      }
    }

    document.querySelector(".prev-month").addEventListener("click", function () {
      currentMonth = (currentMonth === 0) ? 11 : currentMonth - 1;
      currentYear = (currentMonth === 11) ? currentYear - 1 : currentYear;
      generateCalendar(currentMonth, currentYear);
    });

    document.querySelector(".next-month").addEventListener("click", function () {
      currentMonth = (currentMonth === 11) ? 0 : currentMonth + 1;
      currentYear = (currentMonth === 0) ? currentYear + 1 : currentYear;
      generateCalendar(currentMonth, currentYear);
    });

    generateCalendar(currentMonth, currentYear);
  });
</script>
</body>
</html>
