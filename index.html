<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Team ToDo App</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="sidebar">
  <div class="logo">
    <span class="team">Team</span><br>
    <span class="todo">ToDo</span>
  </div>
  <nav>
    <ul>
      <li><button onclick="location.href='index.html'"><img src="yellowhome.png" alt="Home"></button></li>
      <li><button onclick="location.href='edit_profile.html'"><img src="blackprofile.png" alt="Profile"></button></li>
      <li><button onclick="location.href='login.html'"><img src="blacklogout.png" alt="Logout"></button></li>
    </ul>
  </nav>
  <div class="help">
    <button onclick="location.href='help.html'"><img src="help.png" alt="Help"></button>
  </div>
</div>
<div class="main-container">
  <div class="top-container">
    <div class="top-left">
      <div class="calendar-header">
        <button class="calendar-nav-button prev-month">&lt;</button>
        <h2 id="calendar-month">May 2024</h2>
        <button class="calendar-nav-button next-month">&gt;</button>
      </div>
      <table id="calendar">
        <thead>
          <tr>
            <th>일</th>
            <th>월</th>
            <th>화</th>
            <th>수</th>
            <th>목</th>
            <th>금</th>
            <th>토</th>
          </tr>
        </thead>
        <tbody>
          <!-- 달력 날짜가 동적으로 생성될 부분 -->
        </tbody>
      </table>
    </div>
    <div class="top-right">
      <div class="progress">
        <h2>Progress</h2>
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
        <p class="progress-percent">0%</p>
      </div>
      <div class="team-members">
        <div class="team-list">
          <h3>Team Members</h3>
          <ul>
            <li class="team-member-item" data-team="designer">Designer</li>
            <li class="team-member-item" data-team="front-end">Front-end</li>
            <li class="team-member-item" data-team="back-end">Back-end</li>
            <li class="team-member-item" data-team="ai">AI</li>
          </ul>
        </div>
        <div class="member-details">
          <div class="profile-set" id="designer-profile">
            <img src="gu.png" alt="Member Profile" class="profile-pic">
            <div class="profile-info">
              <p class="name">신유진</p>
              <p class="position">단국대학교 / Designer</p>
            </div>
          </div>
          <!-- 다른 팀의 프로필을 추가하려면 여기에 추가 -->
        </div>
      </div>
    </div>
  </div>
  <div class="bottom-container">
    <div class="bottom-left">
      <h2>Team To-Do CheckList</h2>
      <div class="todo-controls">
        <select class="todo-dropdown">
          <option value="task">할 일</option>
          <option value="title">제목</option>
        </select>
        <input type="text" id="todo-input" placeholder="내용을 입력하세요">
        <button class="add-todo-button">+</button>
      </div>
      <ul id="todo-list">
        <li>
          <span class="content bold">홈페이지 UI 수정</span>
          <button class="drag-handle">☰</button>
        </li>
        <li>
          <span class="content"><input type="checkbox"> home 화면 비율 일치 (~5/13)</span>
          <button class="drag-handle">☰</button>
        </li>
        <li>
          <span class="content"><input type="checkbox"> 프로필 설정 페이지 색상 변경 (~5/28)</span>
          <button class="drag-handle">☰</button>
        </li>
        <li>
          <span class="content"><input type="checkbox"> Item Card</span>
          <button class="drag-handle">☰</button>
        </li>
      </ul>
    </div>
    <div class="bottom-right">
      <h2 class="bold">Notice</h2>
      <div id="notice-list">
        <p>신유진 님이 ToDo를 생성하였습니다.</p>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const teamMembers = document.querySelectorAll(".team-member-item");
    const designerProfile = document.getElementById("designer-profile");

    // 기본 설정: 디자이너 프로필 보이게 설정
    designerProfile.style.display = "flex";

    teamMembers.forEach(function (member) {
      member.addEventListener("click", function () {
        const team = this.getAttribute("data-team");
        if (team === "designer") {
          designerProfile.style.display = "flex";
        } else {
          designerProfile.style.display = "none";
        }
      });
    });

    // 오늘 날짜 배경색 변경
    const today = new Date();
    let currentMonth = today.getMonth();
    let currentYear = today.getFullYear();

    function generateCalendar(month, year) {
      const calendar = document.querySelector("#calendar tbody");
      calendar.innerHTML = "";
      const monthAndYear = document.getElementById("calendar-month");
      const firstDay = new Date(year, month).getDay();
      const daysInMonth = 32 - new Date(year, month, 32).getDate();
      const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
      monthAndYear.textContent = `${months[month]} ${year}`;

      let date = 1;
      for (let i = 0; i < 6; i++) {
        const row = document.createElement("tr");
        for (let j = 0; j < 7; j++) {
          if (i === 0 && j < firstDay) {
            const cell = document.createElement("td");
            row.appendChild(cell);
          } else if (date > daysInMonth) {
            break;
          } else {
            const cell = document.createElement("td");
            cell.textContent = date;
            if (date === today.getDate() && year === today.getFullYear() && month === today.getMonth()) {
              cell.style.backgroundColor = "#C6E4FF";
            }
            row.appendChild(cell);
            date++;
          }
        }
        calendar.appendChild(row);
      }
    }

    document.querySelector(".prev-month").addEventListener("click", function () {
      currentMonth = (currentMonth === 0) ? 11 : currentMonth - 1;
      currentYear = (currentMonth === 11) ? currentYear - 1 : currentYear;
      generateCalendar(currentMonth, currentYear);
    });

    document.querySelector(".next-month").addEventListener("click", function () {
      currentMonth = (currentMonth === 11) ? 0 : currentMonth + 1;
      currentYear = (currentMonth === 0) ? currentYear + 1 : currentYear;
      generateCalendar(currentMonth, currentYear);
    });

    generateCalendar(currentMonth, currentYear);

    const todoList = document.getElementById("todo-list");
    const addTodoButton = document.querySelector(".add-todo-button");
    const todoDropdown = document.querySelector(".todo-dropdown");
    const todoInput = document.getElementById("todo-input");
    const noticeList = document.getElementById("notice-list");

    // 저장된 투두리스트 불러오기
    const savedTodoList = JSON.parse(localStorage.getItem("todoList")) || [];
    const savedNoticeList = JSON.parse(localStorage.getItem("noticeList")) || [];

    function renderTodoList() {
      todoList.innerHTML = "";
      savedTodoList.forEach(item => {
        const li = document.createElement("li");
        const content = document.createElement("span");
        content.classList.add("content");

        if (item.type === "task") {
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          if (item.completed) {
            checkbox.checked = true;
          }
          checkbox.addEventListener("change", function () {
            item.completed = checkbox.checked;
            updateProgress();
            localStorage.setItem("todoList", JSON.stringify(savedTodoList));
          });
          content.appendChild(checkbox);
          const textNode = document.createTextNode(` ${item.text}`);
          content.appendChild(textNode);
        } else if (item.type === "title") {
          content.classList.add("bold");
          content.textContent = item.text;
        }

        li.appendChild(content);
        const dragHandleButton = document.createElement("button");
        dragHandleButton.classList.add("drag-handle");
        dragHandleButton.innerHTML = "☰";
        li.appendChild(dragHandleButton);

        todoList.appendChild(li);
      });
    }

    function renderNoticeList() {
      noticeList.innerHTML = "";
      savedNoticeList.forEach(notice => {
        const noticeElement = document.createElement("p");
        noticeElement.textContent = notice;
        noticeList.appendChild(noticeElement);
      });
    }

    function updateProgress() {
      const totalTasks = savedTodoList.filter(item => item.type === "task").length;
      const completedTasks = savedTodoList.filter(item => item.type === "task" && item.completed).length;
      const progressPercent = totalTasks === 0 ? 0 : Math.round((completedTasks / totalTasks) * 100);
      document.querySelector(".progress-percent").textContent = `${progressPercent}%`;
      document.querySelector(".progress-fill").style.width = `${progressPercent}%`;
    }

    renderTodoList();
    renderNoticeList();
    updateProgress();

    addTodoButton.addEventListener("click", function () {
      const selectedOption = todoDropdown.value;
      const todoText = todoInput.value.trim();
      if (todoText === "") return;

      const li = document.createElement("li");
      const content = document.createElement("span");
      content.classList.add("content");

      if (selectedOption === "task") {
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.addEventListener("change", function () {
          const todoIndex = savedTodoList.findIndex(item => item.text === todoText && item.type === "task");
          if (todoIndex > -1) {
            savedTodoList[todoIndex].completed = checkbox.checked;
            updateProgress();
            localStorage.setItem("todoList", JSON.stringify(savedTodoList));
          }
        });
        content.appendChild(checkbox);
        const textNode = document.createTextNode(` ${todoText}`);
        content.appendChild(textNode);

        const notice = document.createElement("p");
        notice.textContent = `신유진 님이 ToDo를 생성하였습니다.`;
        noticeList.appendChild(notice);

        savedNoticeList.push(notice.textContent);
        savedTodoList.push({ type: "task", text: todoText, completed: false });
      } else if (selectedOption === "title") {
        content.classList.add("bold");
        content.textContent = todoText;

        const notice = document.createElement("p");
        notice.textContent = `신유진 님이 Goal을 생성하였습니다.`;
        noticeList.appendChild(notice);

        savedNoticeList.push(notice.textContent);
        savedTodoList.push({ type: "title", text: todoText });
      }

      li.appendChild(content);
      const dragHandleButton = document.createElement("button");
      dragHandleButton.classList.add("drag-handle");
      dragHandleButton.innerHTML = "☰";
      li.appendChild(dragHandleButton);

      todoList.appendChild(li);

      localStorage.setItem("todoList", JSON.stringify(savedTodoList));
      localStorage.setItem("noticeList", JSON.stringify(savedNoticeList));
      updateProgress();

      todoInput.value = ""; // 입력 필드 초기화
    });

    new Sortable(todoList, {
      handle: ".drag-handle",
      animation: 150,
      onEnd: function () {
        const updatedTodoList = [];
        todoList.querySelectorAll("li").forEach(li => {
          const content = li.querySelector(".content");
          if (content.classList.contains("bold")) {
            updatedTodoList.push({ type: "title", text: content.textContent });
          } else {
            const checkbox = content.querySelector("input[type='checkbox']");
            updatedTodoList.push({ type: "task", text: content.textContent.trim(), completed: checkbox.checked });
          }
        });
        savedTodoList.length = 0;
        Array.prototype.push.apply(savedTodoList, updatedTodoList);
        localStorage.setItem("todoList", JSON.stringify(savedTodoList));
      }
    });
  });
</script>
</body>
</html>
